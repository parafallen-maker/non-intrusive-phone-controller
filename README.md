# Semantic Agent - éæ¥è§¦å¼æ‰‹æœºæ§åˆ¶ç³»ç»Ÿ

åŸºäº**ä¸‰å±‚è¯­ä¹‰å®¹å™¨æ¶æ„**çš„ç‰©ç† Agent ç³»ç»Ÿï¼Œé€šè¿‡æœºæ¢°è‡‚ + æ‘„åƒå¤´å®ç°éä¾µå…¥å¼æ‰‹æœºæ§åˆ¶ã€‚

> ğŸ‰ **v3.2 å‘å¸ƒ** - äº‘ç«¯æŠ€èƒ½å…±äº« + è¯­éŸ³è¾“å…¥æ”¯æŒï¼

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ¤– **ä¸‰å±‚æ¶æ„**ï¼šL1 ç­–ç•¥å±‚ (LLM) + L2 è¿è¡Œæ—¶ (Runtime) + L3 æˆ˜æœ¯å±‚ (AutoGLM)
- ğŸ”§ **éæ¥è§¦å¼**ï¼šæœºæ¢°è‡‚ç‰©ç†ç‚¹å‡» + æ‘„åƒå¤´è§†è§‰è¯†åˆ«ï¼Œæ— éœ€ ADB/USB
- â˜ï¸ **äº‘ç«¯æŠ€èƒ½åº“**ï¼šæŠ€èƒ½å¯è·¨è®¾å¤‡å…±äº«ï¼Œä¸€æ¬¡å­¦ä¹ å¤šå¤„å¤ç”¨
- ğŸ¤ **è¯­éŸ³è¾“å…¥**ï¼šé€šè¿‡ TTS + æ‰‹æœºè¯­éŸ³è¯†åˆ«å®ç°æ–‡æœ¬è¾“å…¥
- ğŸ§  **Long-horizon Planning**ï¼šæ”¯æŒ `step()/ask()/checkpoint()` é•¿ç¨‹è§„åˆ’

## ğŸ¯ æ ¸å¿ƒæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L1 ç­–ç•¥å±‚ (Strategy Layer)                                      â”‚
â”‚  - æ¨¡å‹: GPT-4 / Claude / glm-4-flash                           â”‚
â”‚  - èŒè´£: é•¿ç¨‹è§„åˆ’ã€é€»è¾‘ç¼–æ’ã€çŠ¶æ€ç®¡ç†                            â”‚
â”‚  - è¾“å‡º: Python è„šæœ¬ (ç”¨ for/while è°ƒç”¨ step())                  â”‚
â”‚  - ç¦æ­¢: è¾“å‡ºä»»ä½•åæ ‡ï¼ˆè§†è§‰ç¦ä»¤ï¼‰                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ Python ä»£ç 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L2 è¿è¡Œæ—¶ (Runtime Layer)                                       â”‚
â”‚  - ç»„ä»¶: TaskRuntime                                            â”‚
â”‚  - èŒè´£: æ²™ç›’æ‰§è¡Œã€æä¾› step()/ask()/checkpoint() æ¥å£          â”‚
â”‚  - ç‰¹æ€§: Long-horizon Planning æ”¯æŒ                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ step("ç‚¹å‡»æœç´¢æ¡†")
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L3 æˆ˜æœ¯å±‚ (Tactical Layer)                                      â”‚
â”‚  - æ¨¡å‹: AutoGLM (autoglm-phone)                                â”‚
â”‚  - èŒè´£: Grounding (è§†è§‰å®šä½) + å¾®è§‚éªŒè¯                         â”‚
â”‚  - æµç¨‹: æˆªå›¾ â†’ å®šä½åæ ‡ â†’ æ‰§è¡Œ â†’ éªŒè¯ â†’ é‡è¯•                   â”‚
â”‚  - è¾“å‡º: Tap(0.23, 0.67) ç­‰ç²¾ç¡®åæ ‡                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ æœºæ¢°è‡‚æŒ‡ä»¤
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é©±åŠ¨å±‚ (Driver Layer)                                           â”‚
â”‚  - æœºæ¢°è‡‚: Serial / WiFi (ESP32-S3)                             â”‚
â”‚  - æ‘„åƒå¤´: Camera (OpenCV)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
semantic-agent/
â”œâ”€â”€ brain/                    # L1 ç­–ç•¥å±‚
â”‚   â””â”€â”€ strategy_prompt.py   # ç­–ç•¥å±‚ Prompt (è§†è§‰ç¦ä»¤)
â”œâ”€â”€ runtime/                  # L2 è¿è¡Œæ—¶
â”‚   â””â”€â”€ task_runtime_v2.py   # æ²™ç›’æ‰§è¡Œç¯å¢ƒ (step/ask/checkpoint)
â”œâ”€â”€ tactical/                 # L3 æˆ˜æœ¯å±‚
â”‚   â””â”€â”€ autoglm_driver.py    # AutoGLM é©±åŠ¨ (å¾®è§‚é—­ç¯)
â”œâ”€â”€ drivers/                  # ç¡¬ä»¶é©±åŠ¨å±‚
â”‚   â”œâ”€â”€ base_driver.py       # æŠ½è±¡åŸºç±» + @safe_guard
â”‚   â”œâ”€â”€ serial_driver.py     # ä¸²å£é©±åŠ¨ (GRBL)
â”‚   â”œâ”€â”€ wifi_driver.py       # WiFié©±åŠ¨ (ESP32-S3)
â”‚   â”œâ”€â”€ mock_driver.py       # Mocké©±åŠ¨ (æµ‹è¯•)
â”‚   â””â”€â”€ voice_input_driver.py # è¯­éŸ³è¾“å…¥é©±åŠ¨
â”œâ”€â”€ skills/                   # æŠ€èƒ½ç³»ç»Ÿ (äº‘ç«¯æ”¯æŒ) â­
â”‚   â”œâ”€â”€ protocols.py         # åè®®å®šä¹‰
â”‚   â”œâ”€â”€ local_store.py       # æœ¬åœ°å­˜å‚¨
â”‚   â”œâ”€â”€ remote_store.py      # äº‘ç«¯å­˜å‚¨
â”‚   â”œâ”€â”€ sync_manager.py      # åŒæ­¥ç®¡ç†
â”‚   â”œâ”€â”€ skill_manager.py     # ç»Ÿä¸€å…¥å£
â”‚   â””â”€â”€ cloud_service.py     # äº‘æœåŠ¡ (FastAPI)
â”œâ”€â”€ tests/                    # æµ‹è¯•å¥—ä»¶
â”‚   â”œâ”€â”€ test_three_layers.py # ä¸‰å±‚æ¶æ„æµ‹è¯•
â”‚   â”œâ”€â”€ test_skills_module.py # æŠ€èƒ½æ¨¡å—æµ‹è¯• (25 tests)
â”‚   â””â”€â”€ test_voice_input.py  # è¯­éŸ³è¾“å…¥æµ‹è¯•
â”œâ”€â”€ main_v3.py                # ä¸»å…¥å£ (ä¸‰å±‚é›†æˆ + æŠ€èƒ½ç³»ç»Ÿ)
â””â”€â”€ requirements.txt
```

## âš™ï¸ å®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-repo/semantic-agent.git
cd semantic-agent

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env å¡«å…¥ API Key
```

### ç¯å¢ƒå˜é‡

```bash
# å¿…é¡»
ZHIPUAI_API_KEY='your_zhipuai_key'

# å¯é€‰ - äº‘ç«¯æŠ€èƒ½åŒæ­¥
SKILL_API_URL='https://skills.example.com/api/v1'
SKILL_API_KEY='your_skill_api_key'
DEVICE_ID='device-001'
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œæµ‹è¯•

```bash
# ä¸‰å±‚æ¶æ„æµ‹è¯•
python3 tests/test_three_layers.py

# æŠ€èƒ½æ¨¡å—æµ‹è¯• (25 ä¸ªæµ‹è¯•)
python3 tests/test_skills_module.py

# è¯­éŸ³è¾“å…¥æµ‹è¯•
python3 tests/test_voice_input.py
```

### 2. äº¤äº’æ¨¡å¼

```bash
python3 main_v3.py
```

```
ğŸ¯ ä»»åŠ¡: ç»™å‰ 10 æ¡è§†é¢‘ç‚¹èµ

[Skill] æ£€ç´¢åŒ¹é…æŠ€èƒ½...
[Skill] æœªæ‰¾åˆ°åŒ¹é…æŠ€èƒ½ï¼Œå°†ç”Ÿæˆæ–°ä»£ç 

[LLM] ğŸ“ Plan - ç”Ÿæˆæ‰§è¡Œè„šæœ¬...
[Code] æ‰§è¡Œä»£ç :
  1 | step('æ‰“å¼€çŸ­è§†é¢‘åº”ç”¨')
  2 | for i in range(10):
  3 |     step('ç‚¹èµå½“å‰è§†é¢‘')
  4 |     step('æ»‘åŠ¨åˆ°ä¸‹ä¸€ä¸ªè§†é¢‘')

[Runtime] Execute - å¼€å§‹æ‰§è¡Œ...
...
[SemanticAgent] âœ… ä»»åŠ¡å®Œæˆ!
[SemanticAgent] æŠ€èƒ½å·²è’¸é¦ä¿å­˜: ç»™å‰10æ¡è§†é¢‘...
```

### 3. API è°ƒç”¨ç¤ºä¾‹

```python
from main_v3 import SemanticAgent
from drivers.mock_driver import MockDriver

# åˆå§‹åŒ– (æœ¬åœ°æŠ€èƒ½æ¨¡å¼)
driver = MockDriver()
agent = SemanticAgent(
    zhipuai_api_key="your_key",
    driver=driver,
    strategy_model="glm-4-flash",
    tactical_model="autoglm-phone"
)

# åˆå§‹åŒ– (äº‘ç«¯æŠ€èƒ½åŒæ­¥æ¨¡å¼)
agent = SemanticAgent(
    zhipuai_api_key="your_key",
    driver=driver,
    skill_api_url="https://skills.example.com/api/v1",
    skill_api_key="sk-xxx",
    device_id="device-001"
)

# æ‰§è¡Œä»»åŠ¡
result = agent.execute_task("æ‰“å¼€å¾®ä¿¡ï¼Œç»™å¼ ä¸‰å‘æ¶ˆæ¯'æ™šä¸Šåƒé¥­'")

print(f"æˆåŠŸ: {result['success']}")
print(f"ä½¿ç”¨æŠ€èƒ½: {result['skill_used']}")
```

## â˜ï¸ æŠ€èƒ½ç³»ç»Ÿ

### æœ¬åœ°æ¨¡å¼

```python
from skills import SkillManager, Skill

manager = SkillManager.create_local("./skills")

# ä¿å­˜æŠ€èƒ½
skill = Skill(
    id="wechat_like",
    name="å¾®ä¿¡ç‚¹èµ",
    description="ç»™æœ‹å‹åœˆç‚¹èµ",
    code="step('ç‚¹å‡»ç‚¹èµæŒ‰é’®')",
    tags=["å¾®ä¿¡", "ç¤¾äº¤"]
)
manager.save(skill)

# æœç´¢æŠ€èƒ½
matches = manager.search("æœ‹å‹åœˆç‚¹èµ")
```

### äº‘ç«¯æ¨¡å¼

```python
manager = SkillManager.create_cloud(
    local_dir="./skills",
    api_url="https://skills.example.com/api/v1",
    api_key="sk-xxx",
    device_id="device-001"
)
# ä½¿ç”¨æ–¹å¼ç›¸åŒï¼Œè‡ªåŠ¨åå°åŒæ­¥
```

### éƒ¨ç½²äº‘ç«¯æœåŠ¡

```bash
cd skills
pip install fastapi uvicorn
python cloud_service.py  # ç›‘å¬ 0.0.0.0:8080
```

## ğŸ¤ è¯­éŸ³è¾“å…¥

å¯¹äºæ–‡æœ¬è¾“å…¥åœºæ™¯ï¼Œé€šè¿‡ TTS + æ‰‹æœºè¯­éŸ³è¯†åˆ«å®ç°ï¼š

```python
from drivers.voice_input_driver import VoiceInputDriver

driver = VoiceInputDriver(autoglm_driver)
success = driver.input_text("ä½ å¥½ä¸–ç•Œ")
# æµç¨‹: ç‚¹å‡»è¯­éŸ³å›¾æ ‡ â†’ TTSæœ—è¯» â†’ æ‰‹æœºè¯†åˆ« â†’ éªŒè¯
```

## ğŸ¬ å·¥ä½œæµç¨‹ç¤ºä¾‹

### ç”¨æˆ·: "æ¸…ç©ºè´­ç‰©è½¦"

#### Step 1: æŠ€èƒ½æ£€ç´¢
```
[Skill] æ£€ç´¢åŒ¹é…æŠ€èƒ½...
[Skill] æ‰¾åˆ°åŒ¹é…æŠ€èƒ½: æ¸…ç©ºè´­ç‰©è½¦ (åˆ†æ•°: 0.85)
```

#### Step 2: æ‰§è¡Œä»£ç 
```python
step('æ‰“å¼€è´­ç‰©è½¦')
step('ç‚¹å‡»ç¼–è¾‘')
while True:
    if not step('é€‰ä¸­ä¸€ä¸ªå•†å“'):
        break
    step('ç‚¹å‡»åˆ é™¤')
```

#### Step 3: L3 æˆ˜æœ¯å±‚å¤„ç†æ¯ä¸ª step()

ä»¥ `step('ç‚¹å‡»åˆ é™¤')` ä¸ºä¾‹:

1. **Capture**: æ‘„åƒå¤´æˆªå›¾å½“å‰ç•Œé¢
2. **Plan**: AutoGLM è¾“å‡º `Tap(0.85, 0.45)`
3. **Act**: æœºæ¢°è‡‚æ‰§è¡Œ Tap
4. **Verify**: å†æ¬¡æˆªå›¾ï¼ŒAutoGLM ç¡®è®¤"åˆ é™¤æˆåŠŸ"
5. **Return**: è¿”å› True

## âœ… å·²å®ŒæˆåŠŸèƒ½

| æ¨¡å— | æè¿° | çŠ¶æ€ |
|------|------|------|
| `tactical/autoglm_driver.py` | AutoGLM é©±åŠ¨ (è§†è§‰å®šä½ + å¾®è§‚éªŒè¯) | âœ… |
| `runtime/task_runtime_v2.py` | TaskRuntime (step/ask/checkpoint) | âœ… |
| `brain/strategy_prompt.py` | ç­–ç•¥å±‚ Prompt (è§†è§‰ç¦ä»¤) | âœ… |
| `skills/*` | æŠ€èƒ½ç³»ç»Ÿ (æœ¬åœ° + äº‘ç«¯åŒæ­¥) | âœ… |
| `drivers/voice_input_driver.py` | è¯­éŸ³è¾“å…¥é©±åŠ¨ | âœ… |
| `main_v3.py` | ä¸‰å±‚é›†æˆ + æŠ€èƒ½ç³»ç»Ÿ | âœ… |

## ğŸ¯ è®¾è®¡åŸåˆ™

### 1. åæ ‡æ§åˆ¶æƒç§»äº¤
- âŒ **æ—§**: LLM åˆ†ææˆªå›¾ â†’ LLM è¾“å‡ºåæ ‡ â†’ æ‰§è¡Œ
- âœ… **æ–°**: LLM ç¦æ­¢æ¥è§¦åæ ‡ â†’ LLM è¾“å‡ºè¯­ä¹‰ â†’ AutoGLM è¾“å‡ºåæ ‡ â†’ æ‰§è¡Œ

### 2. å¾®è§‚éªŒè¯æƒç§»äº¤
- âŒ **æ—§**: æˆªå›¾å›ä¼ ç­–ç•¥å±‚ LLM éªŒè¯
- âœ… **æ–°**: AutoGLM å†…éƒ¨è‡ªé—­ç¯éªŒè¯

### 3. é€»è¾‘å®¹å™¨å¼•å…¥
- âŒ **æ—§**: çº¿æ€§å¯¹è¯ï¼Œç”¨æˆ·è¯´ä¸€å¥åšä¸€æ­¥
- âœ… **æ–°**: ä»£ç å³è¡ŒåŠ¨ï¼ŒLLM ç”Ÿæˆè„šæœ¬ï¼ŒPython æ§åˆ¶å¾ªç¯

## ğŸ“ æ ¸å¿ƒæ¦‚å¿µ

### AutoGLM å®šä½åˆ†æ

**AutoGLM (autoglm-phone) æ˜¯ä¸€ä¸ª VLA (Vision-Language-Action) æ¨¡å‹ï¼š**

| èƒ½åŠ› | è¯„ä»· |
|------|------|
| **Grounding (è§†è§‰å®šä½)** | âœ… å¼ºé¡¹ï¼ç»™å®ƒæˆªå›¾+"ç‚¹å‡»æœç´¢æ¡†"ï¼Œèƒ½ç²¾å‡†è¾“å‡º [x, y] |
| **UI äº¤äº’ç†è§£** | âœ… çŸ¥é“è¾“å…¥æ¡†è¦ç‚¹ã€æ»‘åŠ¨è¦æ‹–æ‹½ |
| **Long-horizon Planning** | âŒ å¼±é¡¹ï¼å¤æ‚ä»»åŠ¡å®¹æ˜“åœ¨ä¸­é—´è¿·å¤± |

**ç»“è®º**: AutoGLM ä¸é€‚åˆåšç­–ç•¥å±‚ï¼ˆå¤§è„‘ï¼‰ï¼Œé€‚åˆåšæ‰§è¡Œå±‚ï¼ˆå°è„‘/é«˜çº§é©±åŠ¨ï¼‰

### è§†è§‰ç¦ä»¤ (æ ¸å¿ƒè®¾è®¡åŸåˆ™)

**ç­–ç•¥å±‚ LLM ç”Ÿæˆçš„ä»£ç ç¦æ­¢åŒ…å«:**
- âŒ å±å¹•åæ ‡ `(x, y)`
- âŒ åƒç´ é¢œè‰² `#RRGGBB`
- âŒ å›¾åƒå¤„ç†é€»è¾‘

**åªå…è®¸è¯­ä¹‰æè¿°:**
```python
# âœ… æ­£ç¡®
step("ç‚¹å‡»å¾®ä¿¡å›¾æ ‡")
step("å‘ä¸‹æ»‘åŠ¨")

# âŒ é”™è¯¯
tap(0.5, 0.3)
click_at(100, 200)
```

è¿™æ ·ç­–ç•¥å±‚ç”Ÿæˆçš„ä»£ç å¯ä»¥è·¨è®¾å¤‡ã€è·¨åˆ†è¾¨ç‡å¤ç”¨ï¼

### å®‰å…¨å®ˆå«

æ‰€æœ‰ç‰©ç†åŠ¨ä½œéƒ½å— `@safe_guard` ä¿æŠ¤ï¼š

```python
@safe_guard
def tap(self, x: float, y: float):
    # è‡ªåŠ¨æ£€æŸ¥ 0.0 <= x <= 1.0
    # è‡ªåŠ¨æ£€æŸ¥ 0.0 <= y <= 1.0
    # è¶…å‡ºèŒƒå›´æŠ›å‡º SafetyError
    ...
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ PRï¼

## ğŸ“„ License

MIT
