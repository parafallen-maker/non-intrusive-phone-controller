# Semantic Agent - è¯­ä¹‰å®¹å™¨æ¶æ„

åŸºäº**è¯­ä¹‰å®¹å™¨æ¶æ„**çš„ç‰©ç†Agentç³»ç»Ÿï¼Œå®ç° Brain (LLM) + Tactical (AutoGLM) + Hardware çš„åŒè„‘åä½œã€‚

> ğŸ‰ **v1.0 å‘å¸ƒ** - æ‰€æœ‰æ ¸å¿ƒæ¨¡å—å·²å®Œæˆï¼Œé›†æˆæµ‹è¯• 5/5 é€šè¿‡ï¼

## ğŸ¯ é¡¹ç›®ç‰¹ç‚¹

- **åŒè„‘æ¶æ„**ï¼šæˆ˜ç•¥å±‚LLMç”ŸæˆPythoné€»è¾‘ä»£ç ï¼Œæˆ˜æœ¯å±‚AutoGLMå¤„ç†è§†è§‰æ„ŸçŸ¥ä¸æ‰§è¡Œ
- **å¤šç¡¬ä»¶æ”¯æŒ**ï¼šç»Ÿä¸€é©±åŠ¨æŠ½è±¡å±‚ï¼Œæ”¯æŒä¸²å£æœºæ¢°è‡‚å’ŒWiFi/ESP32-S3
- **å®‰å…¨ç¬¬ä¸€**ï¼š`@safe_guard` è£…é¥°å™¨å®æ–½ç‰©ç†è¾¹ç•Œæ£€æŸ¥ï¼Œé˜²æ­¢å±é™©åŠ¨ä½œ
- **Code as Action**ï¼šé€»è¾‘ä¸æ‰§è¡Œå®Œå…¨è§£è€¦ï¼ŒLLMåªå†™ä¸šåŠ¡æµç¨‹
- **è§†è§‰ç¦ä»¤**ï¼šLLMç”Ÿæˆçš„ä»£ç ç¦æ­¢åŒ…å«åæ ‡/é¢œè‰²ï¼Œå…¨éƒ¨ç”±æˆ˜æœ¯å±‚è§†è§‰å¤„ç†
- **æŠ€èƒ½è®°å¿†**ï¼šè‡ªåŠ¨è’¸é¦æ‰§è¡Œè½¨è¿¹ä¸ºå¯å¤ç”¨æŠ€èƒ½

## ğŸ“ é¡¹ç›®ç»“æ„

```
semantic-agent/
â”œâ”€â”€ drivers/                  # ç¡¬ä»¶é©±åŠ¨å±‚ âœ…
â”‚   â”œâ”€â”€ base_driver.py       # æŠ½è±¡åŸºç±» + @safe_guard + SafetyError
â”‚   â”œâ”€â”€ serial_driver.py     # ä¸²å£é©±åŠ¨ (GRBL)
â”‚   â”œâ”€â”€ wifi_driver.py       # WiFié©±åŠ¨ (ESP32-S3)
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ tactical/                 # æˆ˜æœ¯å±‚ âœ…
â”‚   â”œâ”€â”€ vision_adapter.py    # VisionAdapter + MicroAction
â”‚   â”œâ”€â”€ micro_loop.py        # æ„ŸçŸ¥-å†³ç­–-æ‰§è¡Œ-éªŒè¯é—­ç¯
â”‚   â”œâ”€â”€ autoglm_client.py    # AutoGLM å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ action_translator.py # åŠ¨ä½œç¿»è¯‘
â”‚   â”œâ”€â”€ execution_engine.py  # æ‰§è¡Œå¼•æ“
â”‚   â””â”€â”€ models.py
â”œâ”€â”€ runtime/                  # è¿è¡Œæ—¶å®¹å™¨ âœ…
â”‚   â”œâ”€â”€ task_runtime.py      # æ²™ç›’æ‰§è¡Œç¯å¢ƒ (exec + stepæ³¨å…¥)
â”‚   â”œâ”€â”€ planner.py           # LLMä»£ç ç”Ÿæˆå™¨ (å¤šæä¾›å•†)
â”‚   â””â”€â”€ prompts.py           # System Prompt (è§†è§‰ç¦ä»¤)
â”œâ”€â”€ skills/                   # æŠ€èƒ½ç³»ç»Ÿ âœ…
â”‚   â”œâ”€â”€ skill_registry.py    # æŠ€èƒ½æ³¨å†Œè¡¨ (å­˜å‚¨/æœç´¢)
â”‚   â””â”€â”€ skill_distiller.py   # æŠ€èƒ½è’¸é¦å™¨ (è½¨è¿¹â†’å‚æ•°åŒ–ä»£ç )
â”œâ”€â”€ tests/                    # æµ‹è¯• âœ…
â”‚   â””â”€â”€ test_integration.py  # é›†æˆæµ‹è¯• (5/5 é€šè¿‡)
â”œâ”€â”€ gui/                      # æ¡Œé¢GUI
â”‚   â””â”€â”€ motor_control_gui.py # Tkinteræ§åˆ¶é¢æ¿
â”œâ”€â”€ static/                   # Web å‰ç«¯
â”œâ”€â”€ main.py                   # FastAPI æœåŠ¡å™¨
â”œâ”€â”€ config.py                 # é…ç½®ç®¡ç†
â””â”€â”€ requirements.txt
```

## âš™ï¸ å®‰è£…

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env å¡«å…¥ ZHIPU_API_KEY (å¯é€‰ï¼Œç”¨äºçœŸå®LLMè°ƒç”¨)
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œé›†æˆæµ‹è¯•

```bash
python tests/test_integration.py
```

é¢„æœŸè¾“å‡ºï¼š
```
ğŸ‰ æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡!
æ€»è®¡: 5/5 é€šè¿‡
```

### 2. å¯åŠ¨ Web æœåŠ¡

```bash
python main.py
```

è®¿é—® http://localhost:8000

### 3. å®Œæ•´ä½¿ç”¨ç¤ºä¾‹

```python
from runtime.planner import Planner
from runtime.task_runtime import TaskRuntime
from tactical.micro_loop import execute_step
from drivers import WiFiDriver

# 1. åˆå§‹åŒ–
driver = WiFiDriver(device_ip="192.168.1.100")
driver.connect()

planner = Planner(provider='mock')  # æˆ– 'zhipu'/'openai'

# 2. ç”¨æˆ·æŒ‡ä»¤ â†’ Pythonä»£ç 
result = planner.plan("ç»™å¾®ä¿¡æœ‹å‹åœˆå‰3æ¡ç‚¹èµ")
print(result.code)
# step("æ‰“å¼€å¾®ä¿¡")
# step("ç‚¹å‡»å‘ç°")
# step("ç‚¹å‡»æœ‹å‹åœˆ")
# for i in range(3):
#     step(f"ç‚¹å‡»ç¬¬{i+1}æ¡æœ‹å‹åœˆçš„ç‚¹èµæŒ‰é’®")

# 3. æ‰§è¡Œä»£ç ï¼ˆæ¯ä¸ªstepè§¦å‘æˆ˜æœ¯å±‚é—­ç¯ï¼‰
def step(goal: str):
    execute_step(goal, driver, vision_adapter)

runtime = TaskRuntime(step_function=step)
runtime.execute(result.code)
```

### 4. æŠ€èƒ½ç³»ç»Ÿ

```python
from skills.skill_registry import SkillRegistry
from skills.skill_distiller import SkillDistiller, ExecutionTrace

# è’¸é¦æ‰§è¡Œè½¨è¿¹ä¸ºå¯å¤ç”¨æŠ€èƒ½
trace = ExecutionTrace(
    instruction="ç»™å¾®ä¿¡æœ‹å‹åœˆå‰3æ¡ç‚¹èµ",
    code=result.code,
    steps=runtime.executed_steps,
    success=True
)

distiller = SkillDistiller()
skill = distiller.distill(trace)
# skill.code è‡ªåŠ¨å‚æ•°åŒ–ä¸º for i in range(count): ...

# æ³¨å†ŒæŠ€èƒ½
registry = SkillRegistry()
registry.register(
    name=skill.name,
    description=skill.description,
    code=skill.code,
    tags=skill.tags
)

# æœç´¢æŠ€èƒ½
skills = registry.search("æœ‹å‹åœˆç‚¹èµ")
```

## âœ… å·²å®Œæˆ

| ä»»åŠ¡ | æ¨¡å— | æè¿° |
|------|------|------|
| Task 1.1 | `drivers/base_driver.py` | å®‰å…¨å±‚ (`@safe_guard` + `SafetyError`) |
| Task 1.2 | `tactical/vision_adapter.py` | VisionAdapter + MicroAction ç»“æ„åŒ–è¾“å‡º |
| Task 2.1 | `tactical/micro_loop.py` | å¾®è§‚é—­ç¯ (æ„ŸçŸ¥â†’å†³ç­–â†’æ‰§è¡Œâ†’éªŒè¯) |
| Task 3.1 | `runtime/task_runtime.py` | æ²™ç›’æ‰§è¡Œå™¨ (`exec()` + `step()` æ³¨å…¥) |
| Task 4.1 | `runtime/prompts.py` | System Prompt (è§†è§‰ç¦ä»¤) |
| Task 4.2 | `runtime/planner.py` | LLMä»£ç ç”Ÿæˆå™¨ (æ”¯æŒ zhipu/openai/anthropic) |
| Task 5.1 | `skills/skill_registry.py` | æŠ€èƒ½æ³¨å†Œè¡¨ (å­˜å‚¨/æœç´¢/å¯¼å‡º) |
| Task 5.2 | `skills/skill_distiller.py` | æŠ€èƒ½è’¸é¦å™¨ (è½¨è¿¹â†’å‚æ•°åŒ–ä»£ç ) |
| Task 6.1 | `tests/test_integration.py` | é›†æˆæµ‹è¯• (5/5 é€šè¿‡) |

## ğŸ”œ è·¯çº¿å›¾

- [ ] å‘é‡æ•°æ®åº“æŠ€èƒ½æ£€ç´¢ (Chroma/Pinecone)
- [ ] å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡
- [ ] å¼‚å¸¸æ¢å¤ç­–ç•¥
- [ ] çœŸæœºç«¯åˆ°ç«¯æµ‹è¯•

## ğŸ“ æ ¸å¿ƒæ¦‚å¿µ

### è¯­ä¹‰å®¹å™¨æ¶æ„

```
ç”¨æˆ·æŒ‡ä»¤ "ç»™å‰3æ¡æœ‹å‹åœˆç‚¹èµ"
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Brain (Planner + GPT-4/Claude/GLM)     â”‚
â”‚  ç”Ÿæˆ Python ä»£ç ï¼ˆåªæœ‰è¯­ä¹‰ï¼Œæ— åæ ‡ï¼‰     â”‚
â”‚                                         â”‚
â”‚  for i in range(3):                     â”‚
â”‚      step("ç‚¹å‡»ç¬¬{}æ¡çš„ç‚¹èµ".format(i))  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Runtime (TaskRuntime)                  â”‚
â”‚  æ²™ç›’æ‰§è¡Œä»£ç ï¼Œæ‹¦æˆª step() è°ƒç”¨          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tactical (MicroLoop + VisionAdapter)   â”‚
â”‚  æ¯ä¸ª step() è§¦å‘é—­ç¯:                   â”‚
â”‚  1. Capture: æˆªå›¾                       â”‚
â”‚  2. Predict: AutoGLM æ¨ç†åŠ¨ä½œ+åæ ‡       â”‚
â”‚  3. Act: é©±åŠ¨ç¡¬ä»¶æ‰§è¡Œ                    â”‚
â”‚  4. Verify: å†æ¬¡æˆªå›¾ç¡®è®¤å®Œæˆ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hardware (BaseDriver + @safe_guard)    â”‚
â”‚  ç‰©ç†æ‰§è¡Œï¼Œè¾¹ç•Œæ£€æŸ¥ä¿æŠ¤                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Skills (Registry + Distiller)          â”‚
â”‚  æ‰§è¡Œè½¨è¿¹ â†’ è’¸é¦ â†’ å‚æ•°åŒ–æŠ€èƒ½ â†’ å­˜å‚¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è§†è§‰ç¦ä»¤ (æ ¸å¿ƒè®¾è®¡åŸåˆ™)

**Brain å±‚ç”Ÿæˆçš„ä»£ç ç¦æ­¢åŒ…å«:**
- âŒ å±å¹•åæ ‡ `(x, y)`
- âŒ åƒç´ é¢œè‰² `#RRGGBB`
- âŒ å›¾åƒå¤„ç†é€»è¾‘

**åªå…è®¸è¯­ä¹‰æè¿°:**
```python
# âœ… æ­£ç¡®
step("ç‚¹å‡»å¾®ä¿¡å›¾æ ‡")
step("å‘ä¸‹æ»‘åŠ¨")

# âŒ é”™è¯¯
tap(0.5, 0.3)
click_at(100, 200)
```

è¿™æ · Brain ç”Ÿæˆçš„ä»£ç å¯ä»¥è·¨è®¾å¤‡ã€è·¨åˆ†è¾¨ç‡å¤ç”¨ï¼

### å®‰å…¨å®ˆå«

æ‰€æœ‰ç‰©ç†åŠ¨ä½œéƒ½å— `@safe_guard` ä¿æŠ¤ï¼š

```python
@safe_guard
def tap(self, x: float, y: float):
    # è‡ªåŠ¨æ£€æŸ¥ 0.0 <= x <= 1.0
    # è‡ªåŠ¨æ£€æŸ¥ 0.0 <= y <= 1.0
    # è¶…å‡ºèŒƒå›´æŠ›å‡º SafetyError
    ...
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ PRï¼

## ğŸ“„ License

MIT
