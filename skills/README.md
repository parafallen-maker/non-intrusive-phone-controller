# Skills æ¨¡å—

ç‹¬ç«‹çš„æŠ€èƒ½ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒæœ¬åœ°/äº‘ç«¯å­˜å‚¨ï¼Œå¯è·¨è®¾å¤‡å…±äº«æŠ€èƒ½åº“ã€‚

## ç‰¹æ€§

- ğŸ”Œ **è§£è€¦è®¾è®¡**ï¼šåŸºäºåè®®çš„æ¥å£è®¾è®¡ï¼Œæ”¯æŒæœ¬åœ°/è¿œç¨‹å®ç°åˆ‡æ¢
- â˜ï¸ **äº‘ç«¯åŒæ­¥**ï¼šè‡ªåŠ¨åŒæ­¥åˆ°äº‘ç«¯ï¼Œå¤šè®¾å¤‡å…±äº«æŠ€èƒ½åº“
- ğŸ” **è¯­ä¹‰æœç´¢**ï¼šåŸºäºå‘é‡åµŒå…¥çš„è¯­ä¹‰åŒ¹é…
- ğŸ“Š **ä½¿ç”¨ç»Ÿè®¡**ï¼šè®°å½•æŠ€èƒ½ä½¿ç”¨æ¬¡æ•°å’ŒæˆåŠŸç‡
- ğŸ”„ **å†²çªå¤„ç†**ï¼šæ™ºèƒ½å¤„ç†å¤šè®¾å¤‡åŒæ­¥å†²çª

## æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SkillManager                            â”‚
â”‚  (ç»Ÿä¸€ API: save/get/search/distill)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SyncManager                               â”‚
â”‚  (æœ¬åœ°ä¼˜å…ˆå†™å…¥ã€å¼‚æ­¥åŒæ­¥ã€å†²çªå¤„ç†)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    LocalSkillStore      â”‚ â”‚      RemoteSkillStore           â”‚
â”‚  (æ–‡ä»¶ç³»ç»Ÿ + åµŒå…¥ç¼“å­˜)    â”‚ â”‚   (HTTP API + æœ¬åœ°ç¼“å­˜)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¿«é€Ÿå¼€å§‹

### ä»…æœ¬åœ°æ¨¡å¼

```python
from skills import SkillManager, Skill

# åˆ›å»ºç®¡ç†å™¨
manager = SkillManager.create_local("./skills")

# ä¿å­˜æŠ€èƒ½
skill = Skill(
    id="wechat_post",
    name="å‘æœ‹å‹åœˆ",
    description="åœ¨å¾®ä¿¡ä¸­å‘é€ä¸€æ¡æœ‹å‹åœˆåŠ¨æ€",
    code="""
step("ç‚¹å‡»å‘ç°")
step("ç‚¹å‡»æœ‹å‹åœˆ")
step("ç‚¹å‡»å³ä¸Šè§’ç›¸æœºå›¾æ ‡")
step("è¾“å…¥æ–‡å­—å†…å®¹")
step("ç‚¹å‡»å‘è¡¨")
""",
    tags=["å¾®ä¿¡", "ç¤¾äº¤"]
)
manager.save(skill)

# æœç´¢æŠ€èƒ½
matches = manager.search("å‘æœ‹å‹åœˆ")
for match in matches:
    print(f"{match.skill.name}: {match.score:.2f}")

# è·å–æœ€ä½³åŒ¹é…
best = manager.get_best_match("ç»™å¼ ä¸‰æœ‹å‹åœˆç‚¹èµ")
if best:
    print(f"æ‰§è¡ŒæŠ€èƒ½: {best.name}")
```

### äº‘ç«¯åŒæ­¥æ¨¡å¼

```python
from skills import SkillManager

# åˆ›å»ºå¸¦äº‘ç«¯åŒæ­¥çš„ç®¡ç†å™¨
manager = SkillManager.create_cloud(
    local_dir="./skills",
    api_url="https://skills.example.com/api/v1",
    api_key="sk-xxx",
    device_id="device-001"
)

# ä½¿ç”¨æ–¹å¼ä¸æœ¬åœ°ç›¸åŒï¼Œè‡ªåŠ¨åŒæ­¥åˆ°äº‘ç«¯
skill = manager.get_best_match("å‘å¾®ä¿¡")
```

### ç¯å¢ƒå˜é‡é…ç½®

```bash
export SKILL_API_URL="https://skills.example.com/api/v1"
export SKILL_API_KEY="sk-xxx"
export DEVICE_ID="device-001"
```

```python
from skills import init_skill_manager

# è‡ªåŠ¨ä»ç¯å¢ƒå˜é‡è¯»å–é…ç½®
manager = init_skill_manager(local_dir="./skills")
```

## æ ¸å¿ƒ API

### SkillManager

ç»Ÿä¸€çš„æŠ€èƒ½ç®¡ç†å…¥å£ã€‚

```python
# å·¥å‚æ–¹æ³•
manager = SkillManager.create_local(base_dir)           # ä»…æœ¬åœ°
manager = SkillManager.create_cloud(local_dir, ...)     # äº‘ç«¯åŒæ­¥
manager = SkillManager.create_mock()                    # æµ‹è¯•ç”¨

# åŸºç¡€æ“ä½œ
skill_id = manager.save(skill)          # ä¿å­˜
skill = manager.get(skill_id)           # è·å–
manager.delete(skill_id)                # åˆ é™¤
skills = manager.list_all()             # åˆ—å‡ºæ‰€æœ‰

# æœç´¢
matches = manager.search("å‘æœ‹å‹åœˆ", limit=10, min_score=0.5)
best = manager.get_best_match("å‘æœ‹å‹åœˆ", min_score=0.7)

# ä½¿ç”¨ç»Ÿè®¡
manager.record_usage(skill_id, success=True)

# åŒæ­¥æ§åˆ¶
status = manager.sync()                 # æ‰‹åŠ¨åŒæ­¥
status = manager.get_sync_status()      # è·å–çŠ¶æ€

# å¥åº·æ£€æŸ¥
health = manager.health_check()

# ç”Ÿå‘½å‘¨æœŸ
manager.shutdown()
# æˆ–ä½¿ç”¨ context manager
with SkillManager.create_local("./skills") as manager:
    ...
```

### Skill æ•°æ®æ¨¡å‹

```python
from skills import Skill

skill = Skill(
    id="unique_id",              # å”¯ä¸€æ ‡è¯†
    name="æŠ€èƒ½åç§°",              # åç§°
    description="æŠ€èƒ½æè¿°",       # æè¿°
    code="step('...')",          # æŠ€èƒ½ä»£ç 
    tags=["æ ‡ç­¾1", "æ ‡ç­¾2"],      # æ ‡ç­¾
    parameters={"key": "value"}, # å‚æ•°
)

# è®¿é—®å±æ€§
print(skill.use_count)          # ä½¿ç”¨æ¬¡æ•°
print(skill.success_count)      # æˆåŠŸæ¬¡æ•°
print(skill.success_rate)       # æˆåŠŸç‡

# åºåˆ—åŒ–
data = skill.to_dict()
json_str = skill.to_json()

# ååºåˆ—åŒ–
skill = Skill.from_dict(data)
skill = Skill.from_json(json_str)
```

## äº‘ç«¯éƒ¨ç½²

### å¯åŠ¨æœåŠ¡

```bash
cd skills
pip install fastapi uvicorn
python cloud_service.py
```

### API ç«¯ç‚¹

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET | /health | å¥åº·æ£€æŸ¥ |
| GET | /skills | åˆ—å‡ºæ‰€æœ‰æŠ€èƒ½ |
| GET | /skills/{id} | è·å–å•ä¸ªæŠ€èƒ½ |
| POST | /skills | åˆ›å»ºæŠ€èƒ½ |
| PUT | /skills/{id} | æ›´æ–°æŠ€èƒ½ |
| DELETE | /skills/{id} | åˆ é™¤æŠ€èƒ½ |
| POST | /skills/search | æœç´¢æŠ€èƒ½ |
| POST | /skills/sync | åŒæ­¥æŠ€èƒ½ |
| POST | /skills/stats | æ›´æ–°ç»Ÿè®¡ |

### Docker éƒ¨ç½²

```dockerfile
FROM python:3.11-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY skills/ ./skills/

ENV SKILL_API_KEY=your-api-key
EXPOSE 8080

CMD ["uvicorn", "skills.cloud_service:app", "--host", "0.0.0.0", "--port", "8080"]
```

## è‡ªå®šä¹‰æ‰©å±•

### å®ç°è‡ªå®šä¹‰å­˜å‚¨

```python
from skills.protocols import SkillStore, Skill, SkillMatch, SyncStatus
from typing import Optional, List

class MyCustomStore(SkillStore):
    """è‡ªå®šä¹‰å­˜å‚¨å®ç°"""
    
    def save(self, skill: Skill) -> str:
        # å®ç°ä¿å­˜é€»è¾‘
        ...
    
    def get(self, skill_id: str) -> Optional[Skill]:
        # å®ç°è·å–é€»è¾‘
        ...
    
    def delete(self, skill_id: str) -> bool:
        # å®ç°åˆ é™¤é€»è¾‘
        ...
    
    def list_all(self) -> List[Skill]:
        # å®ç°åˆ—è¡¨é€»è¾‘
        ...
    
    def search(self, query: str, limit: int = 10) -> List[SkillMatch]:
        # å®ç°æœç´¢é€»è¾‘
        ...
    
    def update_stats(self, skill_id: str, success: bool) -> None:
        # å®ç°ç»Ÿè®¡æ›´æ–°
        ...
    
    def get_sync_status(self) -> SyncStatus:
        # è¿”å›åŒæ­¥çŠ¶æ€
        ...

# ä½¿ç”¨è‡ªå®šä¹‰å­˜å‚¨
from skills import SkillManager, SkillSyncManager

custom_store = MyCustomStore()
sync_manager = SkillSyncManager(custom_store)
manager = SkillManager(custom_store, None, None, auto_sync=False)
```

### é›†æˆæŠ€èƒ½è’¸é¦å™¨

```python
from skills.protocols import SkillDistillerProtocol

class MyDistiller(SkillDistillerProtocol):
    def distill(self, task: str, trace) -> Optional[Skill]:
        # ä»æ‰§è¡Œè½¨è¿¹è’¸é¦æŠ€èƒ½
        ...

manager = SkillManager.create_local(
    base_dir="./skills",
    distiller=MyDistiller()
)

# è’¸é¦æŠ€èƒ½
skill = manager.distill(task="å‘æœ‹å‹åœˆ", trace=execution_trace, success=True)
```

## æ–‡ä»¶ç»“æ„

```
skills/
â”œâ”€â”€ __init__.py          # æ¨¡å—å…¥å£å’Œå¯¼å‡º
â”œâ”€â”€ protocols.py         # åè®®å®šä¹‰ï¼ˆæ¥å£ï¼‰
â”œâ”€â”€ local_store.py       # æœ¬åœ°æ–‡ä»¶å­˜å‚¨
â”œâ”€â”€ remote_store.py      # è¿œç¨‹ API å®¢æˆ·ç«¯
â”œâ”€â”€ sync_manager.py      # åŒæ­¥ç®¡ç†å™¨
â”œâ”€â”€ skill_manager.py     # ç»Ÿä¸€ç®¡ç†å™¨
â”œâ”€â”€ cloud_service.py     # äº‘ç«¯ FastAPI æœåŠ¡
â””â”€â”€ README.md            # æœ¬æ–‡æ¡£
```

## æµ‹è¯•

```bash
cd semantic-agent
python3 tests/test_skills_module.py
```

## ç‰ˆæœ¬å†å²

- **v2.0.0** - å®Œå…¨é‡æ„ï¼Œæ”¯æŒäº‘ç«¯åŒæ­¥
  - æ–°å¢ SkillManager ç»Ÿä¸€ç®¡ç†å™¨
  - æ–°å¢ SyncManager åŒæ­¥ç®¡ç†
  - æ–°å¢ RemoteSkillStore äº‘ç«¯å­˜å‚¨
  - åŸºäºåè®®çš„è§£è€¦è®¾è®¡
  
- **v1.0.0** - åˆå§‹ç‰ˆæœ¬
  - åŸºç¡€æŠ€èƒ½æ³¨å†Œå’Œæœç´¢
  - æœ¬åœ°æ–‡ä»¶å­˜å‚¨
